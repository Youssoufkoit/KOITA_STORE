"""
Script pour peupler automatiquement la base de donn√©es avec 4 cat√©gories et 24 produits
Ex√©cutez ce script avec: python populate_database.py
"""

import os
import django

# Configuration de Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'koita_store.settings')
django.setup()

from store.models import Category, Product

def clear_database():
    """Nettoie la base de donn√©es"""
    print("üóëÔ∏è  Nettoyage de la base de donn√©es...")
    Product.objects.all().delete()
    Category.objects.all().delete()
    print("‚úÖ Base de donn√©es nettoy√©e\n")

def create_categories():
    """Cr√©e les 4 cat√©gories principales"""
    print("üì¶ Cr√©ation des cat√©gories...")
    
    categories_data = [
        {
            'name': 'DIAMANT FF PAR ID',
            'slug': 'diamant-ff-par-id',
            'description': 'Rechargez vos diamants Free Fire directement par ID. Livraison instantan√©e en moins de 5 minutes !',
            'icon': 'fas fa-gem',
            'order': 1
        },
        {
            'name': 'CODE REDEEM FREE FIRE',
            'slug': 'code-redeem-free-fire',
            'description': 'Codes redeem exclusifs pour Free Fire avec skins rares, bundles et √©motes l√©gendaires',
            'icon': 'fas fa-ticket-alt',
            'order': 2
        },
        {
            'name': 'PUBG MOBILE UC',
            'slug': 'pubg-mobile-uc',
            'description': 'Unknown Cash pour PUBG Mobile. Achetez vos UC au meilleur prix avec livraison rapide',
            'icon': 'fas fa-coins',
            'order': 3
        },
        {
            'name': 'BLOOD STRIKE GOLD',
            'slug': 'blood-strike-gold',
            'description': 'Gold pour Blood Strike. D√©bloquez des armes et skins exclusifs pour dominer la partie',
            'icon': 'fas fa-trophy',
            'order': 4
        },
    ]
    
    categories = {}
    for cat_data in categories_data:
        category = Category.objects.create(**cat_data)
        categories[cat_data['slug']] = category
        print(f"  ‚úÖ {category.name}")
    
    print(f"\nüìä Total: {Category.objects.count()} cat√©gories cr√©√©es\n")
    return categories

def create_products(categories):
    """Cr√©e 24 produits (6 par cat√©gorie)"""
    print("üéÆ Cr√©ation des produits...")
    
    products_data = [
        # ========================================
        # DIAMANT FF PAR ID (6 produits)
        # ========================================
        {
            'name': '50 Diamants Free Fire',
            'description': 'Pack starter parfait pour d√©buter ! 50 diamants livr√©s instantan√©ment sur votre compte Free Fire via votre ID.',
            'price': 500,
            'category': categories['diamant-ff-par-id'],
            'stock': 100,
            'is_active': True,
            'is_featured': False
        },
        {
            'name': '100 Diamants Free Fire',
            'description': 'Rechargement instantan√© de 100 diamants FF. Id√©al pour acheter le Weekly Pass ou des skins basiques.',
            'price': 950,
            'category': categories['diamant-ff-par-id'],
            'stock': 150,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': '310 Diamants Free Fire',
            'description': '310 diamants + BONUS ! Offre populaire pour les joueurs r√©guliers. Parfait pour le Monthly Pass.',
            'price': 2800,
            'category': categories['diamant-ff-par-id'],
            'stock': 200,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': '520 Diamants Free Fire',
            'description': '520 diamants FF avec bonus exclusif. Meilleur rapport qualit√©/prix ! Achetez des bundles premium.',
            'price': 4500,
            'category': categories['diamant-ff-par-id'],
            'stock': 180,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': '1060 Diamants Free Fire',
            'description': '1060 diamants + Bonus sp√©cial. Pour les vrais gamers qui veulent tout d√©bloquer sans limites.',
            'price': 9000,
            'category': categories['diamant-ff-par-id'],
            'stock': 120,
            'is_active': True,
            'is_featured': False
        },
        {
            'name': '2180 Diamants Free Fire',
            'description': 'Pack MEGA ! 2180 diamants + Bonus VIP exclusif. Devenez une l√©gende sur Free Fire avec ce pack ultime.',
            'price': 18000,
            'category': categories['diamant-ff-par-id'],
            'stock': 80,
            'is_active': True,
            'is_featured': True
        },
        
        # ========================================
        # CODE REDEEM FREE FIRE (6 produits)
        # ========================================
        {
            'name': 'Code Skin Fusil AK47 L√©gendaire',
            'description': 'Skin AK47 exclusif de raret√© L√©gendaire avec effets sp√©ciaux ! Code unique garanti valide.',
            'price': 3500,
            'category': categories['code-redeem-free-fire'],
            'stock': 25,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': 'Code Bundle Samurai Elite',
            'description': 'Bundle complet Samurai Elite : tenue, masque, sac √† dos, parachute et emote. Set ultra rare !',
            'price': 5500,
            'category': categories['code-redeem-free-fire'],
            'stock': 15,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': 'Code Emote Dance Exclusive',
            'description': 'Emote de danse ultra rare pour impressionner vos adversaires ! Animation unique et styl√©e.',
            'price': 1800,
            'category': categories['code-redeem-free-fire'],
            'stock': 40,
            'is_active': True,
            'is_featured': False
        },
        {
            'name': 'Code Pet Panda L√©gendaire',
            'description': 'Pet Panda avec comp√©tence sp√©ciale EP++ et apparence kawaii. Votre meilleur alli√© en partie !',
            'price': 4200,
            'category': categories['code-redeem-free-fire'],
            'stock': 20,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': 'Code V√©hicule Monster Truck',
            'description': 'Skin de v√©hicule Monster Truck avec effets sp√©ciaux et boost de vitesse visuel. √âcrasez la concurrence !',
            'price': 3800,
            'category': categories['code-redeem-free-fire'],
            'stock': 18,
            'is_active': True,
            'is_featured': False
        },
        {
            'name': 'Code Parachute Dragon Volant',
            'description': 'Parachute Dragon lumineux avec tra√Æn√©e de particules dor√©es. Atterrissez avec style !',
            'price': 2500,
            'category': categories['code-redeem-free-fire'],
            'stock': 35,
            'is_active': True,
            'is_featured': False
        },
        
        # ========================================
        # PUBG MOBILE UC (6 produits)
        # ========================================
        {
            'name': '60 UC PUBG Mobile',
            'description': '60 Unknown Cash pour PUBG Mobile. Livraison rapide ! Parfait pour le Royale Pass Lite.',
            'price': 600,
            'category': categories['pubg-mobile-uc'],
            'stock': 150,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': '325 UC PUBG Mobile',
            'description': '325 UC + Bonus ! Id√©al pour le Royale Pass complet. D√©bloquez toutes les r√©compenses premium.',
            'price': 3000,
            'category': categories['pubg-mobile-uc'],
            'stock': 120,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': '660 UC PUBG Mobile',
            'description': '660 UC PUBG Mobile - Pack populaire avec bonus. Achetez des caisses et des tenues exclusives.',
            'price': 6000,
            'category': categories['pubg-mobile-uc'],
            'stock': 100,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': '1800 UC PUBG Mobile',
            'description': '1800 UC + Bonus exclusif. Pour les joueurs premium qui veulent les meilleurs skins du jeu !',
            'price': 16000,
            'category': categories['pubg-mobile-uc'],
            'stock': 70,
            'is_active': True,
            'is_featured': False
        },
        {
            'name': '3850 UC PUBG Mobile',
            'description': 'Pack mega 3850 UC avec bonus VIP. Dominez le classement avec les tenues les plus rares !',
            'price': 33000,
            'category': categories['pubg-mobile-uc'],
            'stock': 45,
            'is_active': True,
            'is_featured': False
        },
        {
            'name': '8100 UC PUBG Mobile',
            'description': 'Pack ULTIME ! 8100 UC + Bonus maximum. Devenez une l√©gende PUBG avec ce pack exceptionnel.',
            'price': 68000,
            'category': categories['pubg-mobile-uc'],
            'stock': 25,
            'is_active': True,
            'is_featured': True
        },
        
        # ========================================
        # BLOOD STRIKE GOLD (6 produits)
        # ========================================
        {
            'name': '100 Gold Blood Strike',
            'description': '100 Gold pour Blood Strike. D√©bloquez vos premi√®res armes l√©gendaires et commencez √† dominer !',
            'price': 800,
            'category': categories['blood-strike-gold'],
            'stock': 80,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': '500 Gold Blood Strike',
            'description': '500 Gold + Bonus. Parfait pour les skins premium et les Battle Pass. Excellent rapport qualit√©/prix !',
            'price': 3800,
            'category': categories['blood-strike-gold'],
            'stock': 65,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': '1000 Gold Blood Strike',
            'description': '1000 Gold Blood Strike - Offre populaire avec bonus g√©n√©reux. D√©bloquez plusieurs armes mythiques.',
            'price': 7500,
            'category': categories['blood-strike-gold'],
            'stock': 55,
            'is_active': True,
            'is_featured': True
        },
        {
            'name': '2500 Gold Blood Strike',
            'description': '2500 Gold + Bonus exclusif. Pour les vrais warriors qui veulent la collection compl√®te !',
            'price': 17000,
            'category': categories['blood-strike-gold'],
            'stock': 40,
            'is_active': True,
            'is_featured': False
        },
        {
            'name': '5000 Gold Blood Strike',
            'description': 'Pack mega ! 5000 Gold avec bonus sp√©ciaux. Toutes les armes et tous les skins √† votre port√©e.',
            'price': 32000,
            'category': categories['blood-strike-gold'],
            'stock': 30,
            'is_active': True,
            'is_featured': False
        },
        {
            'name': '10000 Gold Blood Strike',
            'description': 'Pack ULTIME ! 10000 Gold + Bonus VIP maximum. Soyez le joueur le plus styl√© du serveur !',
            'price': 60000,
            'category': categories['blood-strike-gold'],
            'stock': 15,
            'is_active': True,
            'is_featured': True
        },
    ]
    
    product_count = 0
    for product_data in products_data:
        product = Product.objects.create(**product_data)
        product_count += 1
        
        # Affichage avec indicateurs
        featured = "‚≠ê" if product.is_featured else "  "
        stock_status = "üì¶" if product.stock > 50 else "‚ö†Ô∏è" if product.stock > 0 else "‚ùå"
        
        print(f"  {featured} {stock_status} {product.name} - {product.price:,} FCFA")
    
    print(f"\nüìä Total: {Product.objects.count()} produits cr√©√©s\n")

def display_summary():
    """Affiche un r√©sum√© final"""
    print("="*70)
    print("üéâ BASE DE DONN√âES PEUPL√âE AVEC SUCC√àS !")
    print("="*70)
    
    print(f"\nüì¶ CAT√âGORIES : {Category.objects.count()}")
    for category in Category.objects.all().order_by('order'):
        product_count = category.products.count()
        print(f"   ‚Ä¢ {category.name}: {product_count} produits")
    
    print(f"\nüéÆ PRODUITS : {Product.objects.count()}")
    print(f"   ‚Ä¢ Produits vedettes : {Product.objects.filter(is_featured=True).count()}")
    print(f"   ‚Ä¢ Stock total disponible : {sum(p.stock for p in Product.objects.all()):,} unit√©s")
    
    total_value = sum(p.price * p.stock for p in Product.objects.all())
    print(f"   ‚Ä¢ Valeur totale du stock : {total_value:,} FCFA")
    
    print("\n" + "="*70)
    print("‚úÖ PROCHAINES √âTAPES :")
    print("="*70)
    print("1. Lancez le serveur : python manage.py runserver")
    print("2. Acc√©dez √† la page recharges : http://127.0.0.1:8000/recharges/")
    print("3. Testez les filtres par cat√©gorie et la recherche")
    print("4. Connectez-vous √† l'admin : http://127.0.0.1:8000/admin/")
    print("="*70 + "\n")

def main():
    """Fonction principale"""
    print("\n" + "="*70)
    print("üöÄ SCRIPT DE PEUPLEMENT DE LA BASE DE DONN√âES")
    print("="*70 + "\n")
    
    # √âtape 1 : Nettoyage
    clear_database()
    
    # √âtape 2 : Cr√©ation des cat√©gories
    categories = create_categories()
    
    # √âtape 3 : Cr√©ation des produits
    create_products(categories)
    
    # √âtape 4 : Affichage du r√©sum√©
    display_summary()

if __name__ == '__main__':
    main()
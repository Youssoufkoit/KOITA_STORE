{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="checkout-section">
    <div class="checkout-header">
        <h2><i class="fas fa-shopping-bag"></i> Validation de Commande</h2>
        <p>Vérifiez vos informations avant de finaliser</p>
    </div>
    
    <div class="checkout-container">
        <!-- Récapitulatif de la commande -->
        <div class="order-summary-section">
            <div class="section-card">
                <h3><i class="fas fa-receipt"></i> Récapitulatif de votre commande</h3>
                
                <div class="cart-items-summary">
                    {% for item in cart_items %}
                    <div class="summary-item">
                        <div class="item-image-small">
                            {% if item.product.image %}
                                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                            {% else %}
                                <div class="placeholder-image">
                                    <i class="fas fa-image"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="item-details-small">
                            <h4>{{ item.product.name }}</h4>
                            <p class="item-quantity">
                                <i class="fas fa-times"></i> {{ item.quantity }}
                            </p>
                        </div>
                        <div class="item-price-small">
                            {{ item.total_price|floatformat:0 }} FCFA
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="summary-total">
                    <div class="total-row subtotal">
                        <span>Sous-total</span>
                        <span>{{ cart_total|floatformat:0 }} FCFA</span>
                    </div>
                    <div class="total-row shipping">
                        <span><i class="fas fa-truck"></i> Livraison</span>
                        <span class="free-badge">Gratuit</span>
                    </div>
                    <div class="total-row final-total">
                        <span>Total à payer</span>
                        <span class="total-amount">{{ cart_total|floatformat:0 }} FCFA</span>
                    </div>
                </div>
            </div>

            <!-- Informations utilisateur -->
            <div class="section-card user-info-card">
                <h3><i class="fas fa-user-circle"></i> Vos Informations</h3>
                
                <div class="info-grid">
                    <div class="info-item">
                        <i class="fas fa-user"></i>
                        <div class="info-content">
                            <strong>Nom</strong>
                            <span>{{ user.get_full_name|default:user.username }}</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-envelope"></i>
                        <div class="info-content">
                            <strong>Email</strong>
                            <span>{{ user.email }}</span>
                        </div>
                    </div>
                    {% if user.profile.phone %}
                    <div class="info-item">
                        <i class="fas fa-phone"></i>
                        <div class="info-content">
                            <strong>Téléphone</strong>
                            <span>{{ user.profile.phone }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <div class="info-note">
                    <i class="fas fa-info-circle"></i>
                    <p>Les codes REDEEM seront envoyés par email et disponibles dans vos notifications</p>
                </div>
            </div>
        </div>

        <!-- Formulaire de paiement -->
        <div class="payment-section">
            <!-- ID Free Fire si nécessaire -->
            {% if requires_free_fire_id %}
            <div class="section-card free-fire-card">
                <div class="card-header-special">
                    <div class="header-icon fire">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div class="header-content">
                        <h3>ID Free Fire Requis</h3>
                        <p>Nécessaire pour la recharge automatique</p>
                    </div>
                </div>
                
                <form method="post" class="free-fire-form" id="freeFireForm">
                    {% csrf_token %}
                    
                    <div class="free-fire-input-group">
                        <label for="free_fire_id">
                            <i class="fas fa-id-card"></i>
                            Votre ID Free Fire
                        </label>
                        <div class="input-with-status">
                            <input 
                                type="text" 
                                id="free_fire_id" 
                                name="free_fire_id" 
                                value="{{ free_fire_id }}"
                                placeholder="Exemple: 1234567890" 
                                required
                                pattern="[0-9]+"
                                title="Seuls les chiffres sont autorisés"
                                class="free-fire-input"
                            >
                            {% if free_fire_id %}
                            <div class="input-status success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            {% endif %}
                        </div>
                        <small class="input-help">
                            <i class="fas fa-info-circle"></i>
                            L'ID se trouve dans Free Fire → Profil → Base
                        </small>
                    </div>
                    
                    <button type="submit" class="btn-confirm-id">
                        <i class="fas fa-check"></i>
                        {% if free_fire_id %}
                            Modifier et Continuer
                        {% else %}
                            Confirmer l'ID et Continuer
                        {% endif %}
                    </button>
                </form>
            </div>
            {% endif %}
            
            <!-- Méthodes de paiement -->
            <div class="section-card payment-methods-card">
                <h3><i class="fas fa-credit-card"></i> Méthode de Paiement</h3>
                
                <div class="payment-options-grid">
                    <div class="payment-option">
                        <input type="radio" id="wave" name="payment_method" value="wave" checked>
                        <label for="wave">
                            <div class="payment-icon wave">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="payment-info">
                                <strong>Wave</strong>
                                <span>Paiement mobile</span>
                            </div>
                            <div class="payment-check">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </label>
                    </div>
                    
                    <div class="payment-option">
                        <input type="radio" id="orange_money" name="payment_method" value="orange_money">
                        <label for="orange_money">
                            <div class="payment-icon orange">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="payment-info">
                                <strong>Orange Money</strong>
                                <span>Paiement mobile</span>
                            </div>
                            <div class="payment-check">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </label>
                    </div>
                    
                    <div class="payment-option">
                        <input type="radio" id="binance" name="payment_method" value="binance">
                        <label for="binance">
                            <div class="payment-icon crypto">
                                <i class="fab fa-bitcoin"></i>
                            </div>
                            <div class="payment-info">
                                <strong>Binance</strong>
                                <span>Crypto-monnaie</span>
                            </div>
                            <div class="payment-check">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </label>
                    </div>
                    
                    <div class="payment-option">
                        <input type="radio" id="bybit" name="payment_method" value="bybit">
                        <label for="bybit">
                            <div class="payment-icon crypto">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="payment-info">
                                <strong>Bybit</strong>
                                <span>Crypto-monnaie</span>
                            </div>
                            <div class="payment-check">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Validation finale -->
            <div class="section-card final-validation-card">
                <form action="{% url 'cart:process_order' %}" method="post" class="checkout-final-form" id="checkoutForm">
                    {% csrf_token %}
                    <input type="hidden" name="payment_method" id="selected_payment" value="wave">
                    
                    <div class="terms-section">
                        <label class="terms-checkbox">
                            <input type="checkbox" id="terms" name="terms" required>
                            <span class="checkmark"></span>
                            <span class="terms-text">
                                J'accepte les 
                                <a href="#" target="_blank">conditions générales de vente</a>
                                et la 
                                <a href="#" target="_blank">politique de confidentialité</a>
                            </span>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn-pay-now" id="payButton">
                        <span class="btn-icon">
                            <i class="fas fa-lock"></i>
                        </span>
                        <span class="btn-text">Payer Maintenant</span>
                        <span class="btn-amount">{{ cart_total|floatformat:0 }} FCFA</span>
                    </button>
                    
                    <div class="security-badges">
                        <div class="badge-item">
                            <i class="fas fa-shield-check"></i>
                            <span>SSL Sécurisé</span>
                        </div>
                        <div class="badge-item">
                            <i class="fas fa-user-shield"></i>
                            <span>Données Cryptées</span>
                        </div>
                        <div class="badge-item">
                            <i class="fas fa-check-double"></i>
                            <span>Paiement Vérifié</span>
                        </div>
                    </div>
                </form>
                
                <a href="{% url 'cart:cart_view' %}" class="btn-back-to-cart">
                    <i class="fas fa-arrow-left"></i> Retour au panier
                </a>
            </div>
        </div>
    </div>
</section>

<style>
/* ========================================
   CHECKOUT - STYLES MODERNES
======================================== */

:root {
    --checkout-primary: #667eea;
    --checkout-secondary: #764ba2;
    --checkout-success: #2ecc71;
    --checkout-warning: #f39c12;
    --checkout-danger: #e74c3c;
    --checkout-shadow: 0 10px 40px rgba(102, 126, 234, 0.15);
}

.checkout-section {
    animation: fadeInUp 0.8s ease;
    padding: 2rem 0;
}

.checkout-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 2rem;
    background: linear-gradient(135deg, var(--checkout-primary), var(--checkout-secondary));
    border-radius: 20px;
    color: white;
    box-shadow: var(--checkout-shadow);
}

.checkout-header h2 {
    font-size: 2.5rem;
    font-family: "Bebas Neue", sans-serif;
    letter-spacing: 3px;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.checkout-header p {
    font-size: 1.1rem;
    opacity: 0.95;
}

/* Container principal */
.checkout-container {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 2.5rem;
    max-width: 1400px;
    margin: 0 auto;
}

/* Cartes de section */
.section-card {
    background: var(--white);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: var(--checkout-shadow);
    border: 2px solid var(--border-color);
    margin-bottom: 2rem;
    transition: all 0.3s ease;
}

.section-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 50px rgba(102, 126, 234, 0.2);
}

.section-card h3 {
    font-size: 1.5rem;
    font-family: "Montserrat", sans-serif;
    font-weight: 700;
    color: var(--secondary-blue);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

/* Récapitulatif de commande */
.order-summary-section {
    position: sticky;
    top: 100px;
    height: fit-content;
}

.cart-items-summary {
    max-height: 400px;
    overflow-y: auto;
    margin-bottom: 1.5rem;
    padding-right: 0.5rem;
}

.cart-items-summary::-webkit-scrollbar {
    width: 6px;
}

.cart-items-summary::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.cart-items-summary::-webkit-scrollbar-thumb {
    background: var(--checkout-primary);
    border-radius: 10px;
}

.summary-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--light-gray);
    border-radius: 12px;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
}

.summary-item:hover {
    background: #e8eaf0;
    transform: translateX(5px);
}

.item-image-small {
    width: 70px;
    height: 70px;
    border-radius: 10px;
    overflow: hidden;
    flex-shrink: 0;
}

.item-image-small img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.placeholder-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #ddd;
    color: #999;
    font-size: 2rem;
}

.item-details-small {
    flex: 1;
}

.item-details-small h4 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--dark-gray);
    margin-bottom: 0.3rem;
}

.item-quantity {
    font-size: 0.9rem;
    color: #666;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.item-price-small {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--primary-orange);
    font-family: "Bebas Neue", sans-serif;
}

/* Total */
.summary-total {
    padding-top: 1.5rem;
    border-top: 2px solid var(--border-color);
}

.total-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    font-size: 1rem;
}

.total-row span {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.total-row.subtotal {
    color: #666;
}

.total-row.shipping {
    color: var(--checkout-success);
}

.free-badge {
    background: var(--checkout-success);
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    font-size: 0.85rem;
    font-weight: 700;
}

.total-row.final-total {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 2px dashed var(--border-color);
    font-size: 1.2rem;
    font-weight: 700;
}

.total-amount {
    font-size: 1.8rem;
    font-family: "Bebas Neue", sans-serif;
    color: var(--primary-orange);
    letter-spacing: 1px;
}

/* Informations utilisateur */
.user-info-card {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
}

.info-grid {
    display: grid;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.info-item i {
    font-size: 1.5rem;
    color: var(--checkout-primary);
}

.info-content {
    flex: 1;
}

.info-content strong {
    display: block;
    color: var(--dark-gray);
    margin-bottom: 0.3rem;
    font-size: 0.9rem;
}

.info-content span {
    color: #666;
    font-size: 1rem;
}

.info-note {
    display: flex;
    align-items: flex-start;
    gap: 0.8rem;
    padding: 1rem;
    background: rgba(52, 152, 219, 0.1);
    border-left: 4px solid #3498db;
    border-radius: 8px;
}

.info-note i {
    color: #3498db;
    font-size: 1.2rem;
    margin-top: 0.2rem;
}

.info-note p {
    margin: 0;
    color: #2c3e50;
    font-size: 0.95rem;
    line-height: 1.5;
}

/* Carte Free Fire */
.free-fire-card {
    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    border: 3px solid #ff9800;
    box-shadow: 0 10px 30px rgba(255, 152, 0, 0.2);
}

.card-header-special {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid rgba(255, 152, 0, 0.3);
}

.header-icon.fire {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #ff9800, #f57c00);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: white;
    box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
    animation: firePulse 2s infinite;
}

@keyframes firePulse {
    0%, 100% {
        transform: scale(1);
        box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
    }
    50% {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(255, 152, 0, 0.6);
    }
}

.header-content h3 {
    margin: 0 0 0.3rem 0;
    color: #e65100;
    font-size: 1.4rem;
}

.header-content p {
    margin: 0;
    color: #666;
    font-size: 0.95rem;
}

.free-fire-form {
    margin-top: 1.5rem;
}

.free-fire-input-group {
    margin-bottom: 1.5rem;
}

.free-fire-input-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 700;
    color: #e65100;
    margin-bottom: 0.8rem;
    font-size: 1.1rem;
}

.input-with-status {
    position: relative;
}

.free-fire-input {
    width: 100%;
    padding: 1.2rem;
    border: 3px solid #ff9800;
    border-radius: 12px;
    font-size: 1.2rem;
    font-weight: 600;
    text-align: center;
    transition: all 0.3s ease;
    background: white;
}

.free-fire-input:focus {
    outline: none;
    border-color: #e65100;
    box-shadow: 0 0 20px rgba(255, 152, 0, 0.3);
    transform: translateY(-2px);
}

.input-status {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.5rem;
}

.input-status.success {
    color: #2ecc71;
    animation: scaleIn 0.3s ease;
}

@keyframes scaleIn {
    from {
        transform: translateY(-50%) scale(0);
    }
    to {
        transform: translateY(-50%) scale(1);
    }
}

.input-help {
    display: block;
    margin-top: 0.8rem;
    color: #666;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-confirm-id {
    width: 100%;
    padding: 1.2rem 2rem;
    background: linear-gradient(135deg, #ff9800, #f57c00);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 700;
    font-family: "Montserrat", sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
    box-shadow: 0 5px 20px rgba(255, 152, 0, 0.3);
}

.btn-confirm-id:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(255, 152, 0, 0.5);
}

/* Méthodes de paiement */
.payment-methods-card h3 {
    color: var(--checkout-primary);
}

.payment-options-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.payment-option {
    position: relative;
}

.payment-option input[type="radio"] {
    display: none;
}

.payment-option label {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.2rem;
    background: var(--light-gray);
    border: 3px solid var(--border-color);
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.payment-option label::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
    transition: left 0.5s ease;
}

.payment-option label:hover::before {
    left: 100%;
}

.payment-option label:hover {
    border-color: var(--checkout-primary);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
}

.payment-option input[type="radio"]:checked + label {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    border-color: var(--checkout-primary);
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
}

.payment-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    flex-shrink: 0;
}

.payment-icon.wave {
    background: linear-gradient(135deg, #00B8D4, #0097A7);
}

.payment-icon.orange {
    background: linear-gradient(135deg, #FF9800, #F57C00);
}

.payment-icon.crypto {
    background: linear-gradient(135deg, #F7931A, #E67E22);
}

.payment-info {
    flex: 1;
}

.payment-info strong {
    display: block;
    color: var(--dark-gray);
    font-size: 1rem;
    margin-bottom: 0.2rem;
}

.payment-info span {
    color: #666;
    font-size: 0.85rem;
}

.payment-check {
    font-size: 1.5rem;
    color: #ddd;
    transition: all 0.3s ease;
}

.payment-option input[type="radio"]:checked + label .payment-check {
    color: var(--checkout-success);
    transform: scale(1.2);
}

/* Validation finale */
.final-validation-card {
    background: linear-gradient(135deg, #f8f9fa, white);
}

.terms-section {
    margin-bottom: 2rem;
}

.terms-checkbox {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    cursor: pointer;
    position: relative;
    padding-left: 2.5rem;
}

.terms-checkbox input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
}

.checkmark {
    position: absolute;
    left: 0;
    top: 0;
    height: 24px;
    width: 24px;
    background-color: white;
    border: 3px solid var(--border-color);
    border-radius: 6px;
    transition: all 0.3s ease;
}

.terms-checkbox:hover .checkmark {
    border-color: var(--checkout-primary);
}

.terms-checkbox input:checked ~ .checkmark {
    background: linear-gradient(135deg, var(--checkout-primary), var(--checkout-secondary));
    border-color: var(--checkout-primary);
}

.checkmark:after {
    content: "";
    position: absolute;
    display: none;
    left: 7px;
    top: 3px;
    width: 6px;
    height: 11px;
    border: solid white;
    border-width: 0 3px 3px 0;
    transform: rotate(45deg);
}

.terms-checkbox input:checked ~ .checkmark:after {
    display: block;
}

.terms-text {
    color: #666;
    font-size: 0.95rem;
    line-height: 1.6;
}

.terms-text a {
    color: var(--checkout-primary);
    text-decoration: none;
    font-weight: 600;
}

.terms-text a:hover {
    text-decoration: underline;
}

.btn-pay-now {
    width: 100%;
    padding: 1.5rem 2rem;
    background: linear-gradient(135deg, var(--checkout-primary), var(--checkout-secondary));
    color: white;
    border: none;
    border-radius: 15px;
    font-size: 1.2rem;
    font-weight: 700;
    font-family: "Montserrat", sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    margin-bottom: 1.5rem;
}

.btn-pay-now:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
}

.btn-pay-now:active {
    transform: translateY(-1px);
}

.btn-icon {
    font-size: 1.5rem;
}

.btn-amount {
    background: rgba(255, 255, 255, 0.2);
    padding: 0.5rem 1.2rem;
    border-radius: 10px;
    font-family: "Bebas Neue", sans-serif;
    letter-spacing: 1px;
}

.security-badges {
    display: flex;
    justify-content: center;
    gap: 2rem;
    padding: 1rem;
    background: var(--light-gray);
    border-radius: 10px;
    margin-bottom: 1rem;
}

.badge-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--checkout-success);
    font-size: 0.9rem;
    font-weight: 600;
}

.badge-item i {
    font-size: 1.2rem;
}

.btn-back-to-cart {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
    padding: 1rem;
    background: white;
    border: 2px solid var(--border-color);
    color: var(--dark-gray);
    text-decoration: none;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-back-to-cart:hover {
    border-color: var(--checkout-primary);
    color: var(--checkout-primary);
    transform: translateX(-5px);
}

/* ========================================
   RESPONSIVE DESIGN
======================================== */
@media (max-width: 1200px) {
    .checkout-container {
        grid-template-columns: 1fr;
    }
    
    .order-summary-section {
        position: relative;
        top: 0;
    }
}

@media (max-width: 768px) {
    .checkout-header h2 {
        font-size: 2rem;
        flex-direction: column;
    }
    
    .payment-options-grid {
        grid-template-columns: 1fr;
    }
    
    .security-badges {
        flex-direction: column;
        gap: 1rem;
    }
    
    .cart-items-summary {
        max-height: 300px;
    }
}

@media (max-width: 480px) {
    .section-card {
        padding: 1.5rem;
    }
    
    .checkout-header {
        padding: 1.5rem;
    }
    
    .checkout-header h2 {
        font-size: 1.8rem;
    }
    
    .btn-pay-now {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .info-grid {
        gap: 0.8rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gestion des méthodes de paiement
    const paymentOptions = document.querySelectorAll('input[name="payment_method"]');
    const selectedPaymentInput = document.getElementById('selected_payment');
    
    paymentOptions.forEach(option => {
        option.addEventListener('change', function() {
            selectedPaymentInput.value = this.value;
        });
    });
    
    // Validation du formulaire ID Free Fire
    const freeFireForm = document.getElementById('freeFireForm');
    if (freeFireForm) {
        freeFireForm.addEventListener('submit', function(e) {
            const freeFireId = document.getElementById('free_fire_id').value;
            
            if (!freeFireId || !freeFireId.match(/^[0-9]+$/)) {
                e.preventDefault();
                alert('❌ Veuillez entrer un ID Free Fire valide (chiffres uniquement)');
                return false;
            }
        });
    }
    
    // Validation du formulaire final
    const checkoutForm = document.getElementById('checkoutForm');
    if (checkoutForm) {
        checkoutForm.addEventListener('submit', function(e) {
            const termsChecked = document.getElementById('terms').checked;
            
            if (!termsChecked) {
                e.preventDefault();
                alert('❌ Veuillez accepter les conditions générales de vente');
                return false;
            }
            
            // Désactiver le bouton et afficher un loader
            const payButton = document.getElementById('payButton');
            payButton.disabled = true;
            payButton.innerHTML = `
                <i class="fas fa-spinner fa-spin"></i>
                <span>Traitement en cours...</span>
            `;
        });
    }
    
    // Animation des cartes au scroll
    const cards = document.querySelectorAll('.section-card');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
                setTimeout(() => {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }, index * 100);
            }
        });
    }, { threshold: 0.1 });
    
    cards.forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'all 0.5s ease';
        observer.observe(card);
    });
    
    // Validation en temps réel de l'ID Free Fire
    const freeFireInput = document.getElementById('free_fire_id');
    if (freeFireInput) {
        freeFireInput.addEventListener('input', function(e) {
            const value = e.target.value;
            const statusDiv = document.querySelector('.input-status');
            
            // Retirer les caractères non numériques
            e.target.value = value.replace(/[^0-9]/g, '');
            
            // Valider
            if (e.target.value.length >= 8) {
                e.target.style.borderColor = '#2ecc71';
                if (statusDiv) {
                    statusDiv.classList.add('success');
                    statusDiv.innerHTML = '<i class="fas fa-check-circle"></i>';
                }
            } else {
                e.target.style.borderColor = '#ff9800';
                if (statusDiv) {
                    statusDiv.classList.remove('success');
                    statusDiv.innerHTML = '';
                }
            }
        });
    }
    
    // Effet de hover sur les options de paiement
    const paymentLabels = document.querySelectorAll('.payment-option label');
    paymentLabels.forEach(label => {
        label.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px) scale(1.02)';
        });
        
        label.addEventListener('mouseleave', function() {
            if (!this.previousElementSibling.checked) {
                this.style.transform = '';
            }
        });
    });
});

// Fonction pour afficher une notification
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification-toast ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${getNotificationIcon(type)}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.classList.add('show'), 100);
    
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

function getNotificationIcon(type) {
    const icons = {
        success: 'check-circle',
        error: 'exclamation-circle',
        warning: 'exclamation-triangle',
        info: 'info-circle'
    };
    return icons[type] || 'info-circle';
}

// CSS pour les notifications
const style = document.createElement('style');
style.textContent = `
    .notification-toast {
        position: fixed;
        top: 100px;
        right: 20px;
        background: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        z-index: 10000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        border-left: 4px solid;
    }
    
    .notification-toast.show {
        transform: translateX(0);
    }
    
    .notification-toast.success {
        border-left-color: #2ecc71;
    }
    
    .notification-toast.warning {
        border-left-color: #f39c12;
    }
    
    .notification-toast.error {
        border-left-color: #e74c3c;
    }
    
    .notification-toast.info {
        border-left-color: #3498db;
    }
    
    .notification-content {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .notification-content i {
        font-size: 1.2rem;
    }
    
    .notification-toast.success i { color: #2ecc71; }
    .notification-toast.warning i { color: #f39c12; }
    .notification-toast.error i { color: #e74c3c; }
    .notification-toast.info i { color: #3498db; }
`;
document.head.appendChild(style);
</script>
{% endblock %}
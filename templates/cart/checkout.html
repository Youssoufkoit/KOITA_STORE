{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="checkout-container">
    <div class="checkout-header">
        <h1><i class="fas fa-shopping-bag"></i> Validation de Commande</h1>
        <div class="checkout-steps">
            <div class="step active"><span>1</span> Panier</div>
            <div class="step active"><span>2</span> Validation</div>
            <div class="step"><span>3</span> Paiement</div>
            <div class="step"><span>4</span> Confirmation</div>
        </div>
    </div>

    <div class="checkout-content">
        <!-- Colonne gauche : Récapitulatif -->
        <div class="checkout-summary">
            <div class="summary-card">
                <h2><i class="fas fa-receipt"></i> Récapitulatif</h2>
                
                <div class="cart-items">
                    {% for item in cart_items %}
                    <div class="cart-item">
                        <div class="item-image">
                            {% if item.product.image %}
                                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                            {% else %}
                                <div class="no-image"><i class="fas fa-image"></i></div>
                            {% endif %}
                        </div>
                        <div class="item-details">
                            <h4>{{ item.product.name }}</h4>
                            <p class="item-price">{{ item.product.price }} FCFA x {{ item.quantity }}</p>
                            
                            <!-- Afficher l'ID joueur si déjà saisi -->
                            {% if item.product.requires_player_id and item.saved_player_id %}
                            <div class="player-id-info">
                                <i class="fas fa-id-card"></i>
                                <span>ID: {{ item.saved_player_id }}</span>
                            </div>
                            {% endif %}
                        </div>
                        <div class="item-total">
                            {{ item.total_price }} FCFA
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="summary-total">
                    <div class="total-line">
                        <span>Sous-total:</span>
                        <span>{{ cart_total }} FCFA</span>
                    </div>
                    <div class="total-line">
                        <span>Frais de service:</span>
                        <span>0 FCFA</span>
                    </div>
                    <div class="total-line grand-total">
                        <strong>Total:</strong>
                        <strong>{{ cart_total }} FCFA</strong>
                    </div>
                </div>
            </div>

            <!-- Section Assistance -->
            <div class="assistance-card">
                <h3><i class="fas fa-headset"></i> Besoin d'aide ?</h3>
                <div class="assistance-info">
                    <p><i class="fas fa-phone"></i> +221 78 123 45 67</p>
                    <p><i class="fas fa-envelope"></i> support@koitastore.com</p>
                    <p><i class="fab fa-whatsapp"></i> WhatsApp: +221 78 123 45 67</p>
                </div>
            </div>
        </div>

        <!-- Colonne droite : Formulaire -->
        <div class="checkout-form">
            <!-- Section Informations de livraison -->
            <div class="form-section">
                <h3><i class="fas fa-shipping-fast"></i> Informations de livraison</h3>
                <div class="delivery-info">
                    <p><i class="fas fa-bolt"></i> Livraison instantanée pour les recharges automatiques</p>
                    <p><i class="fas fa-envelope"></i> Codes REDEEM envoyés par email et dans votre espace client</p>
                    <p><i class="fas fa-shield-alt"></i> Garantie 100% sécurisée</p>
                </div>
            </div>

            <!-- Section ID Free Fire UNIQUEMENT pour les recharges automatiques -->
            {% if requires_free_fire_id and not all_ids_provided %}
            <div class="form-section free-fire-section">
                <h3><i class="fas fa-id-card"></i> ID Free Fire Requis</h3>
                <div class="alert">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Votre commande contient des recharges automatiques. Veuillez saisir votre ID Free Fire pour procéder à la recharge.</p>
                </div>
                
                <form method="POST" class="free-fire-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="free_fire_id">
                            <i class="fas fa-id-card"></i> Votre ID Free Fire
                        </label>
                        <input type="text" 
                               id="free_fire_id" 
                               name="free_fire_id" 
                               value="{{ free_fire_id }}"
                               placeholder="Ex: 1234567890" 
                               required 
                               pattern="[0-9]{7,15}"
                               title="L'ID Free Fire doit contenir entre 7 et 15 chiffres">
                        <small class="form-help">
                            <i class="fas fa-info-circle"></i> 
                            Votre ID Free Fire se trouve dans les paramètres de jeu (Profil → Base) - Chiffres uniquement
                        </small>
                    </div>
                    
                    <!-- Section méthode de paiement -->
                    <div class="payment-methods">
                        <h4><i class="fas fa-credit-card"></i> Méthode de paiement</h4>
                        <div class="payment-options">
                            <div class="payment-option">
                                <input type="radio" id="wave" name="payment_method" value="wave" checked>
                                <label for="wave">
                                    <i class="fas fa-mobile-alt"></i> Wave
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" id="orange_money" name="payment_method" value="orange_money">
                                <label for="orange_money">
                                    <i class="fas fa-money-bill-wave"></i> Orange Money
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-large">
                        <i class="fas fa-lock"></i> Procéder au paiement
                    </button>
                </form>
            </div>
            {% else %}
            <!-- Si l'ID est déjà fourni ou non requis, afficher directement le formulaire de paiement -->
            <div class="form-section payment-section">
                <h3><i class="fas fa-credit-card"></i> Méthode de Paiement</h3>
                <p class="section-subtitle">Choisissez votre méthode de paiement préférée</p>
                
                <form method="POST" action="{% url 'cart:process_order' %}">
                    {% csrf_token %}
                    
                    <div class="payment-methods">
                        <!-- Wave -->
                        <div class="payment-method">
                            <input type="radio" id="wave" name="payment_method" value="wave" checked>
                            <label for="wave">
                                <div class="payment-icon wave">
                                    <i class="fas fa-mobile-alt"></i>
                                </div>
                                <div class="payment-info">
                                    <span class="payment-name">Wave</span>
                                    <span class="payment-desc">Paiement mobile Sénégal</span>
                                </div>
                                <div class="payment-check">
                                    <i class="fas fa-check"></i>
                                </div>
                            </label>
                        </div>

                        <!-- Orange Money -->
                        <div class="payment-method">
                            <input type="radio" id="orange_money" name="payment_method" value="orange_money">
                            <label for="orange_money">
                                <div class="payment-icon orange">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="payment-info">
                                    <span class="payment-name">Orange Money</span>
                                    <span class="payment-desc">Paiement mobile Orange</span>
                                </div>
                                <div class="payment-check">
                                    <i class="fas fa-check"></i>
                                </div>
                            </label>
                        </div>

                        <!-- Binance -->
                        <div class="payment-method">
                            <input type="radio" id="binance" name="payment_method" value="binance">
                            <label for="binance">
                                <div class="payment-icon binance">
                                    <i class="fab fa-bitcoin"></i>
                                </div>
                                <div class="payment-info">
                                    <span class="payment-name">Binance Pay</span>
                                    <span class="payment-desc">Crypto & P2P</span>
                                </div>
                                <div class="payment-check">
                                    <i class="fas fa-check"></i>
                                </div>
                            </label>
                        </div>

                        <!-- Bybit -->
                        <div class="payment-method">
                            <input type="radio" id="bybit" name="payment_method" value="bybit">
                            <label for="bybit">
                                <div class="payment-icon bybit">
                                    <i class="fas fa-wallet"></i>
                                </div>
                                <div class="payment-info">
                                    <span class="payment-name">Bybit Pay</span>
                                    <span class="payment-desc">Crypto & Trading</span>
                                </div>
                                <div class="payment-check">
                                    <i class="fas fa-check"></i>
                                </div>
                            </label>
                        </div>

                        <!-- Carte Bancaire -->
                        <div class="payment-method">
                            <input type="radio" id="carte_bancaire" name="payment_method" value="carte_bancaire">
                            <label for="carte_bancaire">
                                <div class="payment-icon card">
                                    <i class="fas fa-credit-card"></i>
                                </div>
                                <div class="payment-info">
                                    <span class="payment-name">Carte Bancaire</span>
                                    <span class="payment-desc">VISA / Mastercard</span>
                                </div>
                                <div class="payment-check">
                                    <i class="fas fa-check"></i>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Instructions de paiement -->
                    <div class="payment-instructions">
                        <div class="instruction" data-method="wave">
                            <h4><i class="fas fa-info-circle"></i> Instructions pour Wave</h4>
                            <p>1. Ouvrez l'application Wave<br>2. Allez dans "Payer"<br>3. Scannez le QR code qui apparaîtra<br>4. Confirmez le paiement</p>
                        </div>
                        <div class="instruction" data-method="orange_money">
                            <h4><i class="fas fa-info-circle"></i> Instructions pour Orange Money</h4>
                            <p>1. Composez #144#<br>2. Sélectionnez "Paiement de services"<br>3. Entrez le code marchand<br>4. Confirmez avec votre code secret</p>
                        </div>
                        <div class="instruction" data-method="binance">
                            <h4><i class="fas fa-info-circle"></i> Instructions pour Binance</h4>
                            <p>1. Ouvrez Binance App<br>2. Allez dans "Binance Pay"<br>3. Scannez le QR code<br>4. Confirmez la transaction</p>
                        </div>
                        <div class="instruction" data-method="bybit">
                            <h4><i class="fas fa-info-circle"></i> Instructions pour Bybit</h4>
                            <p>1. Ouvrez Bybit App<br>2. Accédez à "Bybit Pay"<br>3. Scannez le QR code<br>4. Validez la transaction</p>
                        </div>
                        <div class="instruction" data-method="carte_bancaire">
                            <h4><i class="fas fa-info-circle"></i> Instructions Carte Bancaire</h4>
                            <p>1. Vous serez redirigé vers une page sécurisée<br>2. Entrez vos informations de carte<br>3. Confirmez avec le code 3D Secure<br>4. Transaction cryptée et sécurisée</p>
                        </div>
                    </div>

                    <!-- Bouton de Validation -->
                    <div class="checkout-actions">
                        <button type="submit" class="btn btn-primary btn-checkout">
                            <i class="fas fa-lock"></i>
                            <span>Payer {{ cart_total }} FCFA</span>
                            <small>Validation sécurisée SSL</small>
                        </button>

                        <div class="security-guarantee">
                            <div class="security-badges">
                                <div class="badge">
                                    <i class="fas fa-shield-alt"></i>
                                    <span>Paiement 100% sécurisé</span>
                                </div>
                                <div class="badge">
                                    <i class="fas fa-bolt"></i>
                                    <span>Livraison instantanée</span>
                                </div>
                                <div class="badge">
                                    <i class="fas fa-headset"></i>
                                    <span>Support 24h/24</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
/* Variables CSS */
:root {
    --primary: #ff6b35;
    --primary-dark: #e55528;
    --secondary: #38b6ff;
    --success: #2ecc71;
    --warning: #f39c12;
    --danger: #e74c3c;
    --dark: #2c3e50;
    --light: #f8f9fa;
    --border: #e0e0e0;
    --shadow: rgba(0, 0, 0, 0.1);
}

/* Conteneur principal */
.checkout-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

/* En-tête */
.checkout-header {
    text-align: center;
    margin-bottom: 3rem;
}

.checkout-header h1 {
    color: var(--dark);
    font-size: 2.5rem;
    margin-bottom: 1.5rem;
    font-family: "Bebas Neue", sans-serif;
    letter-spacing: 2px;
}

.checkout-steps {
    display: flex;
    justify-content: center;
    gap: 2rem;
}

.step {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #999;
    font-weight: 600;
}

.step.active {
    color: var(--primary);
}

.step span {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: #f0f0f0;
    border-radius: 50%;
    font-size: 0.9rem;
}

.step.active span {
    background: var(--primary);
    color: white;
}

/* Contenu principal */
.checkout-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    align-items: start;
}

/* Colonne récapitulatif */
.checkout-summary {
    position: sticky;
    top: 2rem;
}

.summary-card {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    box-shadow: 0 10px 40px var(--shadow);
    border: 2px solid var(--border);
    margin-bottom: 2rem;
}

.summary-card h2 {
    color: var(--dark);
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--border);
    font-family: "Montserrat", sans-serif;
}

/* Articles du panier */
.cart-items {
    margin-bottom: 2rem;
}

.cart-item {
    display: flex;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border);
}

.cart-item:last-child {
    border-bottom: none;
}

.item-image {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    overflow: hidden;
    background: var(--light);
}

.item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.no-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999;
    background: #f5f5f5;
}

.item-details {
    flex: 1;
}

.item-details h4 {
    color: var(--dark);
    margin-bottom: 0.5rem;
    font-size: 1rem;
}

.item-price {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.player-id-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(46, 204, 113, 0.1);
    padding: 0.5rem;
    border-radius: 6px;
    font-size: 0.85rem;
    color: #27ae60;
}

.player-id-info i {
    font-size: 0.8rem;
}

.item-total {
    font-weight: bold;
    color: var(--primary);
    font-size: 1.1rem;
}

/* Total */
.summary-total {
    border-top: 2px solid var(--border);
    padding-top: 1rem;
}

.total-line {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.8rem;
    color: #666;
}

.grand-total {
    font-size: 1.3rem;
    color: var(--dark);
    border-top: 1px solid var(--border);
    padding-top: 0.8rem;
    margin-top: 0.8rem;
}

/* Carte d'assistance */
.assistance-card {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-radius: 15px;
    padding: 2rem;
    box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
}

.assistance-card h3 {
    margin-bottom: 1.5rem;
    font-family: "Montserrat", sans-serif;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.assistance-info p {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    margin-bottom: 0.8rem;
    font-size: 0.95rem;
}

.assistance-info p:last-child {
    margin-bottom: 0;
}

/* Formulaire */
.checkout-form {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    box-shadow: 0 10px 40px var(--shadow);
    border: 2px solid var(--border);
}

.form-section {
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border);
}

.form-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.form-section h3 {
    color: var(--dark);
    margin-bottom: 1rem;
    font-family: "Montserrat", sans-serif;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-subtitle {
    color: #666;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
}

/* Informations de livraison */
.delivery-info {
    background: rgba(56, 182, 255, 0.1);
    border: 1px solid var(--secondary);
    border-radius: 10px;
    padding: 1.5rem;
}

.delivery-info p {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    margin-bottom: 0.8rem;
    color: var(--dark);
}

.delivery-info p:last-child {
    margin-bottom: 0;
}

/* Section Free Fire */
.free-fire-section {
    background: linear-gradient(135deg, #fff3e0, #ffecb3);
    border: 2px solid #ff9800;
    border-radius: 12px;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

.alert {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    background: rgba(255, 152, 0, 0.1);
    border: 1px solid #ff9800;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1.5rem;
}

.alert i {
    color: #ff9800;
    font-size: 1.2rem;
    margin-top: 0.2rem;
}

.alert p {
    margin: 0;
    color: #e65100;
    font-weight: 500;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.8rem;
    font-weight: 600;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-group input {
    width: 100%;
    padding: 1rem;
    border: 2px solid var(--border);
    border-radius: 10px;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.form-group input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
}

.form-help {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
    color: #666;
    font-size: 0.85rem;
}

/* Méthodes de paiement */
.payment-methods {
    display: grid;
    gap: 1rem;
    margin-bottom: 2rem;
}

.payment-method {
    position: relative;
}

.payment-method input {
    position: absolute;
    opacity: 0;
}

.payment-method label {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.2rem;
    border: 2px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
    position: relative;
}

.payment-method input:checked + label {
    border-color: var(--primary);
    background: rgba(255, 107, 53, 0.05);
    box-shadow: 0 5px 15px rgba(255, 107, 53, 0.2);
}

.payment-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.payment-icon.wave {
    background: #6c5ce7;
}

.payment-icon.orange {
    background: #ff6600;
}

.payment-icon.binance {
    background: #f0b90b;
}

.payment-icon.bybit {
    background: #00d2ff;
}

.payment-icon.card {
    background: #6c5ce7;
}

.payment-info {
    flex: 1;
}

.payment-name {
    display: block;
    font-weight: 600;
    color: var(--dark);
    margin-bottom: 0.2rem;
}

.payment-desc {
    font-size: 0.85rem;
    color: #666;
}

.payment-check {
    opacity: 0;
    color: var(--success);
    transition: opacity 0.3s ease;
}

.payment-method input:checked + label .payment-check {
    opacity: 1;
}

/* Instructions de paiement */
.payment-instructions {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 1.5rem;
}

.instruction {
    display: none;
}

.instruction.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

.instruction h4 {
    color: var(--dark);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: "Montserrat", sans-serif;
}

.instruction p {
    color: #666;
    line-height: 1.6;
    margin: 0;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Actions de checkout */
.checkout-actions {
    margin-top: 2rem;
}

.btn-checkout {
    width: 100%;
    padding: 1.5rem 2rem;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1.2rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.btn-checkout:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(255, 107, 53, 0.4);
}

.btn-checkout small {
    font-size: 0.9rem;
    font-weight: normal;
    opacity: 0.9;
}

.security-guarantee {
    margin-top: 1.5rem;
    text-align: center;
}

.security-badges {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    flex-wrap: wrap;
}

.badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #666;
    font-size: 0.85rem;
}

.badge i {
    color: var(--success);
}

/* Responsive */
@media (max-width: 768px) {
    .checkout-content {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .checkout-steps {
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .security-badges {
        flex-direction: column;
        gap: 1rem;
    }
    
    .payment-method label {
        padding: 1rem;
    }
    
    .payment-icon {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gestion des méthodes de paiement
    const paymentMethods = document.querySelectorAll('.payment-method input');
    const instructions = document.querySelectorAll('.instruction');
    
    // Afficher les instructions pour la méthode sélectionnée par défaut (Wave)
    showInstructions('wave');
    
    paymentMethods.forEach(method => {
        method.addEventListener('change', function() {
            if (this.checked) {
                const methodValue = this.value;
                showInstructions(methodValue);
                
                // Animation de sélection
                const label = this.closest('.payment-method').querySelector('label');
                document.querySelectorAll('.payment-method label').forEach(l => {
                    l.style.transform = 'scale(1)';
                });
                label.style.transform = 'scale(1.02)';
                
                setTimeout(() => {
                    label.style.transform = 'scale(1)';
                }, 200);
            }
        });
    });
    
    function showInstructions(method) {
        // Cacher toutes les instructions
        instructions.forEach(instruction => {
            instruction.classList.remove('active');
        });
        
        // Afficher l'instruction correspondante
        const targetInstruction = document.querySelector(`.instruction[data-method="${method}"]`);
        if (targetInstruction) {
            targetInstruction.classList.add('active');
        }
    }
    
    // Validation du formulaire Free Fire ID
    const freeFireForm = document.querySelector('.free-fire-form');
    if (freeFireForm) {
        freeFireForm.addEventListener('submit', function(e) {
            const freeFireInput = document.getElementById('free_fire_id');
            if (freeFireInput && freeFireInput.required) {
                const freeFireValue = freeFireInput.value.trim();
                
                if (!freeFireValue) {
                    e.preventDefault();
                    showError(freeFireInput, "L'ID Free Fire est requis");
                    return false;
                }
                
                if (!/^\d{7,15}$/.test(freeFireValue)) {
                    e.preventDefault();
                    showError(freeFireInput, "L'ID Free Fire doit contenir entre 7 et 15 chiffres");
                    return false;
                }
            }
            
            // Animation de chargement
            const button = this.querySelector('.btn-primary');
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Traitement en cours...';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.disabled = false;
            }, 3000);
            
            return true;
        });
    }
    
    // Validation du formulaire de paiement direct
    const paymentForm = document.querySelector('form[action*="process_order"]');
    if (paymentForm) {
        paymentForm.addEventListener('submit', function(e) {
            // Animation de chargement
            const button = this.querySelector('.btn-checkout');
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Traitement en cours...</span>';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.disabled = false;
            }, 3000);
            
            return true;
        });
    }
    
    function showError(input, message) {
        input.style.borderColor = 'var(--danger)';
        input.focus();
        
        // Supprimer les anciens messages d'erreur
        const existingError = input.parentNode.querySelector('.error-message');
        if (existingError) {
            existingError.remove();
        }
        
        // Ajouter le message d'erreur
        const errorMessage = document.createElement('div');
        errorMessage.className = 'error-message';
        errorMessage.style.color = 'var(--danger)';
        errorMessage.style.fontSize = '0.85rem';
        errorMessage.style.marginTop = '0.5rem';
        errorMessage.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
        input.parentNode.appendChild(errorMessage);
        
        // Animation d'erreur
        input.style.animation = 'shake 0.5s ease-in-out';
        setTimeout(() => {
            input.style.animation = '';
        }, 500);
    }
    
    // Nettoyer les erreurs lors de la saisie
    const freeFireInput = document.getElementById('free_fire_id');
    if (freeFireInput) {
        freeFireInput.addEventListener('input', function() {
            this.style.borderColor = '';
            const errorMessage = this.parentNode.querySelector('.error-message');
            if (errorMessage) {
                errorMessage.remove();
            }
        });
    }
    
    // Animation de secousse pour les erreurs
    const style = document.createElement('style');
    style.textContent = `
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %}